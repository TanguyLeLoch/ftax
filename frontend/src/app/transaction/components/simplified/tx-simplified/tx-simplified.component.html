<form [formGroup]="txForm" (ngSubmit)="onSubmit()" class="tx-simplified">

  <div class="foldable-container" (click)="open()" [ngClass]="{'open': !isCollapsed, 'closed': isCollapsed}">
    <div class="not-collapsed-content" [ngClass]="{'open': !isCollapsed, 'closed': isCollapsed}">
      <span>On</span>

      <mat-form-field >
        <mat-label>Date</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="date">
        <span matTextPrefix (click)="picker.open()" >
          <mat-icon aria-hidden="false" aria-label="Open picker" fontIcon="event"></mat-icon>
        </span>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <span>at</span>

      <!--                        -->
      <!--         TIME           -->
      <!--                        -->
            <mat-form-field>
              <mat-label>Time</mat-label>

              <input formControlName="time" matInput id="settime" type="time" step="1" placeholder="start date" />
            </mat-form-field>


      <br class="mobile-break">

      <span>I</span>

      <!--                        -->
      <!--         ACTION         -->
      <!--                        -->
      <mat-form-field>
        <mat-label>Action</mat-label>
        <mat-select formControlName="type" id="">
          @for (action of actions; track action) {
            <mat-option [value]="action.value">{{action.text}}</mat-option>
          }
        </mat-select>
      </mat-form-field>


      <!--                        -->
      <!--         AMOUNT         -->
      <!--                        -->
      <mat-form-field floatLabel="always" [style.width.px]=120>
        <mat-label>Amount</mat-label>
        <input formControlName="amount"
               matInput type="number" class="right-align" placeholder="0.00"  />
        <mat-error *ngIf="txForm.get('amount')?.hasError('notNegative')">
          Cannot be negative
        </mat-error>
      </mat-form-field>

      <!--                        -->
      <!--         TOKEN          -->
      <!--                        -->
      <mat-form-field class="example-full-width" floatLabel="always">
        <mat-label>Token</mat-label>

        <div class="input-container">
          <input type="text" matInput formControlName="token"
                 [formControl]="tokenControl" [matAutocomplete]="auto"
                 placeholder="Token">
          <fa-icon class="add-token"
                   *ngIf="txForm.get('token')?.hasError('invalidString')"
                   [icon]="faPlus" (click)="addToken()"></fa-icon>
        </div>
        <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
          @for (option of filteredOptions | async; track option) {
            <mat-option [value]="option">{{ option.name }}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>

      <br class="mobile-break">

      <span>for</span>

      <!--                        -->
      <!--      DOLLAR VALUE      -->
      <!--                        -->
      <mat-form-field floatLabel="always" [style.width.px]=120 class="form-field">
        <mat-label>Fiat value</mat-label>
        <input formControlName="dollarValue"
               matInput type="number" class="right-align" placeholder="0.00"  />
        <mat-error *ngIf="txForm.get('dollarValue')?.hasError('notNegative')">
          Cannot be negative
        </mat-error>
        <span matTextPrefix>$&nbsp;</span>
      </mat-form-field>


      <button class="btn-transparent" type="submit" [disabled]="txForm.invalid">
        I confirm
      </button>
    </div>
    <div class="colapsed-content" [ngClass]="{'open': !isCollapsed, 'closed': isCollapsed}">
      <div class="left-colapsed-content">
        <ng-container *ngIf="!isValid; else placeholder">
          <fa-icon class="warning-icon" [icon]="faWarning"></fa-icon>
        </ng-container>
        <ng-template #placeholder>
          <div class="icon-placeholder"></div>
        </ng-template>
      </div>
      <div class="right-colapsed-content">
        <span>{{ txForm.value.date.toLocaleDateString() }}</span>
        <div class="second-line">
          <span> {{ txForm.value.type === 'BUY' ? 'Buy' : 'Sell' }}</span>
          <span> {{ txForm.value.amount }} {{ txForm.value.token?.name }} ({{ txForm.value.token?.ticker }})</span>
        </div>
      </div>
      <div class="far-right-colapsed-content">
      </div>

    </div>

  </div>

</form>

<app-modal [isOpen]="addTokenOpen" (close)="addTokenOpen = false">
  <form [formGroup]="tokenForm" (ngSubmit)="onSubmitToken()"
        class="token-form">
    <mat-form-field appearance="fill">
      <mat-label>Name</mat-label>
      <input matInput placeholder="Bitcoin" formControlName="name">
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Ticker</mat-label>
      <input matInput placeholder="BTC" formControlName="ticker">
    </mat-form-field>

    <button mat-button type="submit">Create</button>

  </form>

</app-modal>
